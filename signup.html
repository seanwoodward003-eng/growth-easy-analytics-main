<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Start Free Trial – GrowthEasy AI</title>
  <link rel="stylesheet" href="styles.css?v=10">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:system-ui,sans-serif; }
    body { background:#0a0f2c; color:#e0e7ff; min-height:100vh; padding-bottom:80px; display:flex; flex-direction:column; }
    .header { padding:20px; text-align:center; border-bottom:1px solid #00ffff; }
    .header h1 { color:#00ffff; font-size:1.8rem; text-shadow:0 0 10px #00ffff; }
    .page { padding:20px; flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; }
    .page.active { display:flex; }
    .card { background:rgba(0,0,0,0.8); padding:30px; border-radius:16px; text-align:center; max-width:380px; width:100%; border:1px solid #00ffff; }
    .price-box { background:rgba(0,255,255,0.1); padding:20px; border-radius:12px; margin:15px 0; }
    .price { font-size:2.5rem; color:#00ffff; font-weight:bold; }
    .price span { font-size:1rem; color:#88c0ff; }
    input { width:100%; padding:14px; margin:12px 0; border:1px solid #00ffff; border-radius:8px; background:transparent; color:#e0e7ff; }
    button { width:100%; padding:16px; background:#00ffff; color:#0a0f2c; border:none; border-radius:12px; font-weight:bold; cursor:pointer; margin-top:10px; }
    .subtext { margin-top:12px; color:#88c0ff; font-size:0.9rem; }
    .checkbox-label { display:flex; align-items:flex-start; gap:.5rem; font-size:.9rem; color:#e0e7ff; margin:1.2rem 0; cursor:pointer; text-align:left; }
    .checkbox-label input { margin-top:.2rem; }
    .checkbox-label a { color:#00ffff; text-decoration:underline; }
    .mobile-nav { position:fixed; bottom:0; left:0; right:0; background:#0a0f2c; border-top:1px solid #00ffff; display:flex; z-index:1000; }
    .mobile-nav button { flex:1; padding:16px; background:transparent; color:#00ffff; border:none; font-weight:bold; }
    .mobile-nav button.active { background:rgba(0,255,255,0.2); }
    .loading { opacity:.6; pointer-events:none; }
  </style>
</head>
<body>

  <div class="header"><h1>GrowthEasy AI</h1></div>

  <!-- SIGNUP PAGE -->
  <div id="signup" class="page active">
    <div class="card">
      <h2 style="color:#00ffff;">AI Growth for Shopify</h2>
      <p style="margin:10px 0;">Full access. 7 days free.</p>

      <div class="price-box">
        <div class="price">£0<span> for 7 days</span></div>
        <p class="subtext"><strong>Card required</strong> — won’t charge until Day 8.<br>£25/month auto-charged after trial. Cancel anytime.</p>
      </div>

      <ul style="text-align:left; margin:15px 0; font-size:0.95rem;">
        <li>AI churn detection</li>
        <li>Revenue forecasting</li>
        <li>Shopify + GA4 sync + HubSpot</li>
        <li>Daily AI tips</li>
        <li>Export reports</li>
      </ul>

      <input type="email" id="email" placeholder="Your email" required />
      <label class="checkbox-label">
        <input type="checkbox" id="consent" required />
        <span>I consent to data processing per our <a href="privacy.html" target="_blank">GDPR policy</a>.</span>
      </label>
      <button id="trialBtn" onclick="startTrial()">Start 7-Day Free Trial</button>
    </div>
  </div>

  <!-- MOBILE NAV -->
  <div class="mobile-nav">
    <button onclick="go('performance')">Performance</button>
    <button onclick="go('acquisition')">Acquisition</button>
    <button class="active" onclick="go('signup')">Signup</button>
  </div>

<script>
  // -------------------------------------------------
  // CONFIG
  // -------------------------------------------------
  const RENDER_URL = 'https://growth-easy-analytics-2.onrender.com';
  const DASHBOARD_URL = 'index.html';               // <-- your dashboard

  // -------------------------------------------------
  // HELPERS
  // -------------------------------------------------
  function setClientToken(token) {
    localStorage.setItem('growseasy_token', token);
    localStorage.setItem('growseasy_user_email', document.getElementById('email').value.trim());
    // Force welcome overlay on first successful trial
    localStorage.removeItem('growseasy_welcome_shown');
  }

  // -------------------------------------------------
  // START TRIAL
  // -------------------------------------------------
  async function startTrial(retries = 0) {
    const email = document.getElementById('email').value.trim();
    const consent = document.getElementById('consent').checked;
    const btn = document.getElementById('trialBtn');

    if (!email.includes('@') || !consent) {
      return alert('Please enter a valid email and agree to the GDPR policy.');
    }

    btn.classList.add('loading');
    btn.textContent = 'Creating Trial...';

    try {
      // 1. Warm-up Render (no-cors, fire-and-forget)
      fetch(`${RENDER_URL}/health`, { method: 'GET', mode: 'no-cors' }).catch(() => {});
      await new Promise(r => setTimeout(r, 600));   // give Render a moment

      // 2. Create trial
      const res = await fetch(`${RENDER_URL}/create-trial`, {
        method: 'POST',
        credentials: 'include',                     // send cookies
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, consent })
      });

      let data;
      try { data = await res.json(); }
      catch { data = { error: await res.text() || `HTTP ${res.status}` }; }

      if (res.ok && data.success && data.token) {
        // Server should set an **HttpOnly** cookie named `token`
        // We also store a copy in localStorage for the pure-HTML dashboard
        setClientToken(data.token);
        window.location.href = DASHBOARD_URL;
      } else {
        throw new Error(data.error || 'Unknown server error');
      }
    } catch (e) {
      console.error('Trial error:', e);
      if (retries < 1 && /Load failed|network/i.test(e.message)) {
        btn.textContent = 'Retrying...';
        return setTimeout(() => startTrial(retries + 1), 1500);
      }
      alert(`Failed: ${e.message}`);
    } finally {
      if (retries === 0) {
        btn.classList.remove('loading');
        btn.textContent = 'Start 7-Day Free Trial';
      }
    }
  }

  // -------------------------------------------------
  // NAVIGATION (mobile tabs – optional)
  // -------------------------------------------------
  function go(page) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const el = document.getElementById(page);
    if (el) el.classList.add('active');

    document.querySelectorAll('.mobile-nav button').forEach(b => b.classList.remove('active'));
    event.target.classList.add('active');
  }
</script>

</body>
</html>